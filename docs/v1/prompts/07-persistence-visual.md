# 지속성 설계 & 비주얼 가이드라인

## 목표

죄책감 기반 동기 부여 없이, 여행 내러티브를 통한 자연스러운 리텐션 시스템을 구현합니다.
비주얼은 "학습 앱"이 아닌 "여행 가이드북" 톤으로 통일합니다.

핵심: **"스트릭이 끊겼습니다!" 금지. "도쿄가 그리워요. 잠깐 들러볼까요?"**

이 플랜에는 다음 기능이 포함되어 있습니다.

1. 여행 내러티브 알림 (일일/연속/복귀)
2. 세션 완결감 + 중도 이탈 복귀 시스템
3. 여행 D-Day 기능 (출발일 기반 학습 자동 조절)
4. 상황별 색상 테마 + 비주얼 가이드라인 적용
5. Anti-Patterns 검증 (레벨/XP/점수/스트릭 경고 제거)

## 요구 결과물

1. `lib/notifications.ts` — 여행 내러티브 알림 로직
2. `lib/sessionResume.ts` — 중도 이탈 복귀 + 진행 저장
3. `components/DDayBanner.tsx` — 여행 D-Day 카운트다운
4. `constants/situationThemes.ts` — 상황별 색상/이모지/분위기 테마
5. 기존 `theme.ts` 업데이트 — 전체 비주얼 가이드라인 반영
6. Anti-Pattern 제거 확인 리스트

## 타겟 프로젝트

`app/` 밑에 있는 메인 서비스를 대상으로 합니다.

## 전체 프로세스 주의사항

1. 하나의 스텝이 완료되면 git commit이 발생되어야 합니다.
2. 하나의 스텝이 완료되면 자동으로 다음 스텝으로 넘어가세요.
3. 모든 프로젝트 작성과, 실행을 통한 검증이 완료되기 전까지는 스텝과 루프를 종료하지 마세요.
4. 더 이상 진행할 수 없을 정도로 모호한 경우에만 중단하고 질문을 요청하세요.
5. 적절한 agent team 멤버를 구성하세요. 모든 작업에는 무조건 리뷰어가 할당되어야 하며, 각 스텝의 완료 직전에도 리뷰가 진행되어야 합니다.
6. 절대 전체 프로세스를 컨텍스트에서 관리하지 마세요. PLAN.md 파일을 이용하십시오.

## 상세 프로세스

### 1. 여행 내러티브 알림 설계 및 구현

기존 알림 시스템(연속 학습일 배지)을 여행 내러티브로 전환합니다.

**알림 3유형 (v1 기획서):**

| 유형 | 예시 | 톤 |
|------|------|-----|
| 일일 | "편의점에서 새로운 상황이 기다리고 있어요" | 여행 내러티브 |
| 연속 | "3일째 도쿄 여행 중!" | 격려 |
| 복귀 | "도쿄가 그리워요. 잠깐 들러볼까요?" | 가볍게 |

**절대 금지:**
- ⛔ "스트릭이 끊겼습니다!"
- ⛔ "목표 미달성"
- ⛔ 죄책감 유발 알림

**구현:**
- `expo-notifications` 활용 (이미 설치되어 있을 수 있음, 확인 필요)
- 알림 텍스트는 완료된 상황 + 다음 추천 상황에 따라 동적 생성
- 기존 스트릭 표시를 "도쿄 여행 N일차!"로 리프레이밍

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어 — 푸시 알림 구현
2. 카피라이터 리뷰어 — 알림 텍스트가 여행 내러티브인지, 학습 앱 톤인지 검증

### 2. 세션 완결감 + 중도 이탈 복귀

**세션 종료 시:**
- ⛔ "85점", "정답률 70%"
- ✅ "오늘 당신은 식당에서 주문을 할 수 있게 되었습니다 🍜"

**중도 이탈 시:**
- 진행 상태를 Phase + 현재 활동 단위로 저장
- 복귀 시: "지난번에 주문 중이었어요. 이어서 할까요?"
- [이어서 하기] / [처음부터 하기] 선택

**구현:**
- `sessionResume.ts`: 세션 상태 스냅샷 저장/복원
  - 현재 Phase, 활동 인덱스, 대화 턴 수, 사용자 응답 기록
  - AsyncStorage에 저장 (앱 종료 대응)
- 완료 화면: 기존 `SessionScreen`의 축하 화면을 능력 서술로 교체

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. QA 엔지니어 — 다양한 이탈 시점(Phase 1 중간, Phase 3 대화 중 등)에서 복귀 테스트

### 3. 여행 D-Day 기능

출발일 등록 시 남은 일수에 맞춰 학습 순서/강도를 자동 조절합니다.

**D-Day 스케줄:**
- D-30: 전 상황 한 번씩 (기본 8개 + 추천 순서)
- D-7: 핵심 상황 집중 반복 (공항, 전철, 식당, 편의점)
- D-1: 핵심 표현 10개 요약 카드

**구현:**
- `SettingsScreen`에 "출발일 설정" 추가 (DatePicker)
- `DDayBanner.tsx`: 홈 화면 상단에 "D-14 ✈ 출발까지 14일" 표시
- 남은 일수에 따라 "오늘의 추천" 알고리즘 가중치 변경
- D-1에 특별 화면: "핵심 표현 10개" 요약 카드 (플래시카드 형태)

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. 데이터 분석가 — D-Day별 추천 알고리즘 가중치 설계

### 4. 비주얼 가이드라인 적용

전체 앱에 여행 가이드북 톤의 비주얼을 적용합니다.

**상황별 색상 테마 (v1 기획서):**

| 상황 | 색상 | 근거 |
|------|------|------|
| 공항 | 하늘색 + 흰 | 개방감 |
| 전철 | 녹색 + 회색 | 야마노테선 |
| 호텔 | 베이지 + 갈색 | 로비 |
| 편의점 | 흰 + 컬러풀 | 밝은 조명 |
| 식당 | 주황 + 나무색 | 이자카야 |
| 관광지 | 붉은색 + 녹색 | 도리이 |
| 쇼핑 | 분홍 + 흰 | 상점가 |
| 긴급 | 파란 + 흰 | 신뢰/안정 |

**전체 톤:**
- 분위기: 여행 가이드북 (Monocle/Airbnb Experience 톤)
- 일러스트: 실사가 아닌 따뜻한 일러스트 (MVP에서는 이모지 + 배경색)
- 타이포: 일본어 고딕체 / 한국어 본고딕

**구현:**
- `situationThemes.ts`: 상황별 primary/secondary/background 색상
- 기존 `theme.ts` 업데이트: 여행 가이드북 톤 반영
- 상황 진입 시 해당 테마 색상 적용 (헤더, 배경, 버튼 등)
- 다크 모드에서도 상황별 색감 유지 (어두운 톤 변환)

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. 비주얼 디자인 리뷰어 — 색상 조합의 가독성 + 분위기 검증

### 5. Anti-Patterns 전수 검증

v1 기획서의 Anti-Pattern 목록을 기준으로 전체 코드를 점검합니다.

**제거 대상 (반드시 확인):**

| 배제 항목 | 이유 | 검색 키워드 |
|-----------|------|------------|
| 레벨 / XP / 리더보드 | "학습 게임" 멘탈 모델 | `level`, `xp`, `exp`, `leaderboard` |
| 스트릭 끊김 경고 | 죄책감 기반 동기 | `streak`, `끊`, `미달` |
| "틀렸습니다" 메시지 | 시험 멘탈 모델 | `틀렸`, `wrong`, `incorrect` |
| 점수 / 백분율 | 평가 느낌 | `점`, `score`, `%`, `정답률` |
| 단어장 암기 | 맥락 없는 암기 | 이미 VocabularyScreen 존재 — 역할 재정의 필요 |
| 독립 문법 강의 | 체험 후 정리용으로만 | — |
| 한국어 발음 표기 | L1 음운 매핑 | `발음`, `pronunciation_ko`, `reading_ko` |
| L1 번역 상시 표시 | 경유지화 | `meaning_ko` 상시 표시 코드 |
| 받아쓰기 | 목표는 회화 | — |

해당 작업에는 5개 이상의 subagent를 이용하십시오.
- 각 subagent는 2~3개 Anti-Pattern을 담당하여 코드 전수 검색
- 결과를 `ANTI_PATTERNS_AUDIT.md`에 정리
- 발견된 항목별 수정 방안 제시

### 6. 통합 테스트

전체 지속성 + 비주얼 변경을 검증합니다.

**테스트 시나리오:**
- 알림: 여행 내러티브 톤 확인 (죄책감 표현 없음)
- 세션 완결: "오늘 식당에서 주문할 수 있게 되었습니다" 표시
- 중도 이탈: Phase 3 중간에 앱 종료 → 재진입 시 "이어서 할까요?" 확인
- D-Day: 출발일 설정 → 배너 표시 → 추천 변경 확인
- 비주얼: 각 상황 진입 시 테마 색상 변경 확인
- Anti-Pattern: 전수 검증에서 발견된 항목 모두 수정 확인

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. QA 엔지니어 2명 — 지속성 시나리오 + 비주얼 검증
2. 프론트엔드 엔지니어 — 버그 수정

## 참고사항

1. 기존 `SettingsScreen`에 TTS 속도, 다크 모드, 페르소나 변경이 이미 있습니다. D-Day 설정을 자연스럽게 통합하세요.
2. 기존 스트릭 로직은 삭제하지 말고, "도쿄 여행 N일차"로 리프레이밍합니다.
3. `expo-notifications` 설치 여부를 먼저 확인하세요. 미설치 시 `npx expo install expo-notifications`.
4. Anti-Pattern 검증에서 기존 `VocabularyScreen`, `FlashcardScreen`의 역할을 재정의해야 할 수 있습니다.
   이 화면들은 "단어장 암기"가 아닌 "도구 세트 확인 + 소리 복습"으로 리포지셔닝합니다.
5. 관련 v1 기획서: `docs/v1/Part3_문자_반복_AI_지속성.md` 지속성 + 비주얼 + Anti-Patterns 섹션
