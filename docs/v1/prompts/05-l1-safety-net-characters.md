# L1 안전망 & 문자 체계: 앰비언트 노출

## 목표

한국어(L1)를 "경유지"가 아닌 "안전망"으로 재설계합니다.
문자는 가르치지 않되, 회화 상황 안에서 반복 노출되어 부산물로 읽기 능력이 생기게 합니다.

핵심 원칙: **소리가 먼저, 문자는 나중. 한국어는 막힐 때만.**

이 플랜에는 다음 기능이 포함되어 있습니다.

1. [?] 안전망 시스템 — 탭하면 한국어 뜻 3초 표시 후 소멸
2. [?] 안전망의 점진적 후퇴 (노출 횟수별 동작 변화)
3. 히라가나 앰비언트 노출 — 별도 あいうえお 학습 없음
4. 가타카나 외래어 원어 힌트
5. 한자는 환경 요소(메뉴판, 역 표지판)로만 등장
6. 문자 인식 간헐 체크 (음성 없이 히라가나만 보여주고 그림 고르기)

## 요구 결과물

1. `components/SafetyNetTooltip.tsx` — [?] 탭 → 한국어 3초 표시 → 소멸
2. `lib/exposureTracker.ts` — 단어별 노출 횟수 추적 + 안전망 동작 결정
3. `components/KanaDisplay.tsx` — 히라가나/가타카나 표시 (한국어 발음 없음)
4. 기존 `NpcBubble`, `FuriganaText` 컴포넌트에 안전망 통합
5. 시뮬레이터에서 안전망 점진적 후퇴 동작 확인

## 타겟 프로젝트

`app/` 밑에 있는 메인 서비스를 대상으로 합니다.

## 전체 프로세스 주의사항

1. 하나의 스텝이 완료되면 git commit이 발생되어야 합니다.
2. 하나의 스텝이 완료되면 자동으로 다음 스텝으로 넘어가세요.
3. 모든 프로젝트 작성과, 실행을 통한 검증이 완료되기 전까지는 스텝과 루프를 종료하지 마세요.
4. 더 이상 진행할 수 없을 정도로 모호한 경우에만 중단하고 질문을 요청하세요.
5. 적절한 agent team 멤버를 구성하세요. 모든 작업에는 무조건 리뷰어가 할당되어야 하며, 각 스텝의 완료 직전에도 리뷰가 진행되어야 합니다.
6. 절대 전체 프로세스를 컨텍스트에서 관리하지 마세요. PLAN.md 파일을 이용하십시오.

## 상세 프로세스

### 1. 안전망 동작 규칙 설계 및 노출 추적 모델

단어별 노출 횟수를 추적하고, 횟수에 따라 [?] 안전망의 동작이 달라지는 시스템을 설계합니다.

**[?] 안전망의 점진적 후퇴:**

| 노출 횟수 | [?] 탭 시 |
|-----------|-----------|
| 1~5회 | 탭 즉시 → 한국어 뜻 3초 표시 후 소멸 |
| 6~10회 | 🔊 "먼저 소리를 다시 들어보세요" → 3초 후 한국어 |
| 11회~ | 그림 힌트만 표시. 한국어는 2차 탭 |

단어별 독립 추적. 이 변화를 사용자에게 알리지 않습니다.

**노출 추적 데이터 모델:**

```typescript
interface ExposureRecord {
  word: string;             // 'ふたり'
  exposureCount: number;    // 누적 노출 횟수
  lastExposedAt: string;    // ISO date
  safetyNetTaps: number;    // [?] 탭 횟수
  recognizedWithoutAudio: boolean; // 문자만으로 인식 성공 여부
}
```

저장소: AsyncStorage (로컬) + Supabase (동기화)

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 데이터 모델 설계자 — 노출 추적 스키마
2. 프론트엔드 엔지니어 — AsyncStorage + Supabase 동기화 방식 검증

### 2. SafetyNetTooltip 컴포넌트 구현

[?] 버튼을 탭하면 노출 횟수에 따라 다른 동작을 하는 컴포넌트를 구현합니다.

**구현 세부사항:**
- [?] 아이콘은 각 단어/표현 옆에 작게 배치
- 탭 시 `exposureTracker`에서 현재 단어의 노출 횟수 조회
- 1~5회: 한국어 뜻이 회색으로 페이드인 → 3초 유지 → 페이드아웃
- 6~10회: 먼저 TTS 재생 → 3초 대기 → 한국어 뜻 표시
- 11회~: 그림 힌트(이모지) 표시 → 2차 탭 시 한국어
- 애니메이션: `Animated.timing`으로 opacity 0→1→0

**절대 하지 않는 것:**
- 한국어 발음 표기 (후타리, 이랏샤이마세 등) — 발음 화석화 방지
- 한국어 상시 표시 — L1 경유지화 방지

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. UX 리뷰어 — 3초 소멸 타이밍, 페이드 애니메이션 자연스러움 검증

### 3. 히라가나/가타카나 앰비언트 노출 구현

**히라가나: 처음부터 화면에 있되, 읽으라는 압력 제로**

```
🔊 ふたり
   [?]      ← 탭하면 "2명" 3초 표시 후 소멸
```

사용자는 🔊로 소리를 듣고, [?]로 뜻을 확인합니다. "ふたり"를 읽을 줄 알 필요 없습니다.
하지만 같은 소리에 같은 문자가 반복 노출되면서 연결이 쌓입니다.

**가타카나: 외래어 활용**

```
🔊 ビール
   [?]      ← "맥주 (beer)" 3초 표시
```

원어 힌트 "(beer)"가 외래어 패턴 인식을 돕습니다.

**한자: 환경 요소로만**

회화 자막에 한자 사용 안 함. 메뉴판, 역 표지판 등 상황 내 배경으로만 등장.
한자를 못 읽어도 🔊와 [?]로 소리와 뜻 확인 가능.

**구현:**
- 기존 `FuriganaText.tsx` 확장 — 후리가나 위에 [?] 아이콘 통합
- `NpcBubble.tsx` — 핵심 표현에 하이라이트 색상 적용
- 한자 포함 텍스트는 후리가나(히라가나 읽기)와 함께 표시

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. 일본어 교육 리뷰어 — 앰비언트 노출의 효과성 검증

### 4. 문자 인식 간헐 체크 구현

Phase 2(포착)에 10~20% 비율로 삽입되는 문자 인식 활동을 구현합니다.

```
(음성 없음)
     ふたり
🧑    🧑🧑    🧑🧑🧑

💡 소리가 필요하면 탭하세요
```

- 음성 없이 히라가나만 보여주고 그림 고르기
- 못 맞혀도 패널티 없음
- 내부적으로 "아직 안전망 유지" 판단에 활용
- 맞히면 `recognizedWithoutAudio: true` 기록

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. QA 엔지니어 — 삽입 빈도(10~20%), 정답/오답 처리 로직 검증

### 5. 기존 컴포넌트 통합 및 테스트

안전망 시스템을 기존 UI 컴포넌트에 통합합니다.

**통합 대상:**
- `NpcBubble.tsx` — 각 텍스트 옆에 [?] 안전망 추가
- `UserBubble.tsx` — 사용자 발화 결과에 [?] 추가 (교정 피드백 시)
- `WatchPhase.tsx` (03-four-phase에서 생성) — [💬 한국어로 보기] 기능
- `CatchPhase.tsx` — 문자 인식 간헐 체크 삽입
- `ReviewPhase.tsx` — 핵심 표현 목록에 [?] 안전망

**테스트 시나리오:**
- 새 단어 첫 노출: [?] 탭 → 한국어 즉시 표시 → 3초 소멸
- 같은 단어 7회차: [?] 탭 → 소리 먼저 → 3초 후 한국어
- 같은 단어 12회차: [?] 탭 → 그림 힌트 → 2차 탭 → 한국어
- 한국어 발음 표기가 어디에도 없는지 전수 확인

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. QA 엔지니어 2명 — 점진적 후퇴 시나리오별 테스트
2. 프론트엔드 엔지니어 — 통합 및 버그 수정

## 참고사항

1. 이 프롬프트는 `03-four-phase-learning.md`의 Phase 1(관찰)과 Phase 2(포착)에 직접 의존합니다.
   03이 먼저 완료된 상태에서 진행하거나, 병렬 진행 시 인터페이스를 먼저 합의하세요.
2. 노출 추적 데이터는 오프라인에서도 작동해야 합니다. AsyncStorage 우선, 온라인 시 Supabase 동기화.
3. "한국어 발음 표기를 쓰지 않는다"는 프로젝트 전체 불변 규칙입니다. 코드 리뷰에서 반드시 확인하세요.
4. 관련 v1 기획서: `docs/v1/Part1_원칙_온보딩_메인.md` 핵심 원칙 2번 + `docs/v1/Part3_문자_반복_AI_지속성.md` 문자 체계 섹션
