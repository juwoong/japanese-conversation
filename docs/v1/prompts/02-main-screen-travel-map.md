# 메인 화면: 여행 동선 지도

## 목표

현재 리스트 기반 메인 화면(`HomeScreen.tsx`)을 여행 동선 지도로 전면 교체합니다.
"레슨 목록"이 아닌 "도쿄 여행 동선"이라는 멘탈 모델을 만듭니다.

이 플랜에는 다음 기능이 포함되어 있습니다.

1. 도쿄 여행 지도 UI (공항→전철→호텔→편의점→식당→관광지→쇼핑→긴급상황)
2. Soft Gating — 모든 상황 열어두되, 시각적으로 권장 순서 유도
3. 능력 기반 진행도 서술 ("혼자 전철을 타고, 편의점에서 물건을 살 수 있습니다")
4. "오늘의 추천" 상황 표시 (간격 반복 기반)

## 요구 결과물

1. 리디자인된 `HomeScreen.tsx` — 지도 기반 UI
2. 새 컴포넌트 `TravelMap.tsx` — 노드+경로 시각화
3. 새 컴포넌트 `AbilityStatement.tsx` — 능력 기반 진행도 텍스트
4. 시뮬레이터에서 지도 탭 → 상황 진입 플로우 확인
5. 기존 `SituationListScreen`과의 역할 정리 (통합 또는 분리)

## 타겟 프로젝트

`app/` 밑에 있는 메인 서비스를 대상으로 합니다.

## 전체 프로세스 주의사항

1. 하나의 스텝이 완료되면 git commit이 발생되어야 합니다.
2. 하나의 스텝이 완료되면 자동으로 다음 스텝으로 넘어가세요.
3. 모든 프로젝트 작성과, 실행을 통한 검증이 완료되기 전까지는 스텝과 루프를 종료하지 마세요.
4. 더 이상 진행할 수 없을 정도로 모호한 경우에만 중단하고 질문을 요청하세요.
5. 적절한 agent team 멤버를 구성하세요. 모든 작업에는 무조건 리뷰어가 할당되어야 하며, 각 스텝의 완료 직전에도 리뷰가 진행되어야 합니다.
6. 절대 전체 프로세스를 컨텍스트에서 관리하지 마세요. PLAN.md 파일을 이용하십시오.

## 상세 프로세스

### 1. 현재 메인 화면 분석 및 지도 데이터 모델 설계

현재 `HomeScreen.tsx`와 `SituationListScreen.tsx`를 읽고,
기존 데이터 흐름(Supabase에서 상황 목록 로드 → 진행률 표시)을 파악합니다.

**설계해야 할 데이터 모델:**

```typescript
interface MapNode {
  situation_slug: string;      // 'airport', 'train', 'hotel' ...
  label: string;               // '공항', '전철', '호텔' ...
  emoji: string;               // '✈', '🚃', '🏨' ...
  color: string;               // 상황별 테마 컬러
  position: { x: number; y: number };  // 지도 내 좌표
  status: 'completed' | 'recommended' | 'available' | 'advanced';
  connections: string[];       // 연결된 다음 노드 slug 목록
}
```

**Soft Gating 규칙:**
- 완료: 컬러 아이콘 + ✓
- 권장 다음: 컬러 + 펄스 애니메이션
- 건너뛴 상황: opacity 0.6, 탭 가능
- 고급: opacity 낮음 + "공항, 전철을 먼저 해보는 걸 추천해요" 토스트

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어 — 데이터 모델 + 상태 관리 설계
2. UX 디자이너 — 지도 레이아웃 + 노드 배치 검증

### 2. TravelMap 컴포넌트 구현

여행 지도의 핵심 시각화 컴포넌트를 구현합니다.

**구현 세부사항:**
- React Native의 `View` + `Animated`로 구현 (외부 지도 라이브러리 불필요)
- 노드 간 연결선은 SVG 또는 `react-native-svg`의 `Line`/`Path` 사용
- 각 노드는 터치 가능한 원형 아이콘 (이모지 + 배경색)
- 권장 노드에 `Animated.loop`으로 펄스 애니메이션
- 스크롤 가능한 세로 레이아웃 (공항이 상단, 긴급상황이 하단)

**MVP 8개 상황 배치 (v1 기획서 기준):**

| 순서 | 상황 | 이모지 | 도입 표현 |
|------|------|--------|-----------|
| 1 | 공항 | ✈ | すみません, ありがとう |
| 2 | 전철 | 🚃 | ～はどこですか |
| 3 | 호텔 | 🏨 | ～をおねがいします |
| 4 | 편의점 | 🏪 | ～をください |
| 5 | 식당 | 🍜 | ～にします, おかいけい |
| 6 | 관광지 | ⛩ | しゃしんをとってもらえますか |
| 7 | 쇼핑 | 🛍 | ～はありますか |
| 8 | 긴급상황 | 🆘 | たすけてください, いたい |

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어 2명 — 레이아웃 + 애니메이션 분담
2. QA 엔지니어 — 다양한 화면 크기에서 레이아웃 확인

### 3. 능력 기반 진행도 + "오늘의 추천" 구현

XP/레벨 대신 능력 서술 문장을 표시합니다.

**진행도 서술 규칙:**
- ⛔ "레벨 7", "1,240 XP"
- ✅ "혼자 전철을 타고, 편의점에서 물건을 살 수 있습니다"

**구현:**
- `AbilityStatement.tsx` — 완료된 상황 목록을 받아 자연어 문장 생성
- 상황별 능력 매핑 테이블 하드코딩 (MVP):
  ```
  airport → "공항에서 안내를 받을 수"
  train → "전철을 탈 수"
  hotel → "호텔에 체크인할 수"
  ...
  ```
- "오늘의 추천": 기존 FSRS 간격 반복 로직(`fsrs.ts`) 활용하여 복습 시점이 된 상황을 추천

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. 카피라이터 역할의 리뷰어 — 능력 서술 문장이 자연스러운지 검증

### 4. HomeScreen 통합 및 SituationListScreen 역할 정리

`HomeScreen`에 TravelMap + AbilityStatement + "오늘의 추천"을 통합합니다.
기존 `SituationListScreen`은 페르소나별 전체 목록 조회용으로 유지하되,
메인 진입 경로는 지도를 통하도록 변경합니다.

**기존 HomeScreen에서 제거할 것:**
- quickActions 목록 (플래시카드는 다른 경로로 접근)
- 기존 진행률 바 (능력 서술로 대체)

**유지할 것:**
- 복습 알림 배너 (오늘의 추천으로 통합)
- 스트릭 표시 (여행 일수로 리프레이밍: "도쿄 여행 3일차!")
- 오프라인 배너

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. 프론트엔드 엔지니어
2. QA 엔지니어 — 지도 탭 → 세션 진입 → 완료 → 지도 복귀 전체 플로우 검증

### 5. 통합 테스트

시뮬레이터에서 다음을 검증합니다.

- 신규 유저: 온보딩 → 지도 (공항만 권장, 나머지 available)
- 공항 완료 후: 지도 (공항 ✓, 전철 펄스)
- 상황 건너뛰기: 식당 탭 → "공항, 전철을 먼저 해보는 걸 추천해요" 토스트 → 진입 가능
- 능력 서술: 완료 상황에 따라 문장 변경 확인
- 오늘의 추천: 복습 시점 상황이 하이라이트되는지 확인

해당 작업에는 다음 에이전틱 팀이 구성되어야 합니다.

1. QA 엔지니어 2명
2. 프론트엔드 엔지니어

## 참고사항

1. 현재 51개 시나리오(기본 22개 + 변주 29개)가 존재하지만, 지도에는 MVP 8개 기본 상황만 노드로 표시합니다.
2. 변주 시나리오는 기본 상황 탭 후 리스트로 확인 가능하게 합니다.
3. `react-native-svg`는 아직 설치되지 않았을 수 있습니다. 필요 시 설치하세요.
4. 관련 v1 기획서: `docs/v1/Part1_원칙_온보딩_메인.md` 메인 화면 섹션
